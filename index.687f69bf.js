!function(){function e(e,t,r,n,i,o,a){try{var l=e[o](a),s=l.value}catch(e){r(e);return}l.done?t(s):Promise.resolve(s).then(n,i)}function t(t){return function(){var r=this,n=arguments;return new Promise(function(i,o){var a=t.apply(r,n);function l(t){e(a,i,o,l,s,"next",t)}function s(t){e(a,i,o,l,s,"throw",t)}l(void 0)})}}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function n(e){return function(e){if(Array.isArray(e))return r(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return r(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return r(e,void 0)}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){var r,n,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=l(0),a.throw=l(1),a.return=l(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function l(l){return function(s){return function(l){if(r)throw TypeError("Generator is already executing.");for(;a&&(a=0,l[0]&&(o=0)),o;)try{if(r=1,n&&(i=2&l[0]?n.return:l[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,l[1])).done)return i;switch(n=0,i&&(l=[2&l[0],i.value]),l[0]){case 0:case 1:i=l;break;case 4:return o.label++,{value:l[1],done:!1};case 5:o.label++,n=l[1],l=[0];continue;case 7:l=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===l[0]||2===l[0])){o=0;continue}if(3===l[0]&&(!i||l[1]>i[0]&&l[1]<i[3])){o.label=l[1];break}if(6===l[0]&&o.label<i[1]){o.label=i[1],i=l;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(l);break}i[2]&&o.ops.pop(),o.trys.pop();continue}l=t.call(e,o)}catch(e){l=[6,e],n=0}finally{r=i=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,s])}}}"function"==typeof SuppressedError&&SuppressedError;var o={};function a(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function l(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function s(e,t,r){return t&&l(e.prototype,t),r&&l(e,r),e}o=/*#__PURE__*/function(){function e(t,r){a(this,e),this.value=t,this.tileElement=document.createElement("div"),this.tileElement.classList.add("tile"),r.append(this.tileElement),this.setValue(t)}return s(e,[{key:"setCoords",value:function(e,t){this.row=e,this.col=t,this.tileElement.style.setProperty("--row",e),this.tileElement.style.setProperty("--col",t)}},{key:"setValue",value:function(e){this.value=e,this.tileElement.classList.add("tile--".concat(this.value)),this.tileElement.textContent=this.value}},{key:"removeFromDom",value:function(){this.tileElement.remove()}},{key:"waitForTransitionEnd",value:function(){var e=this;return new Promise(function(t){e.tileElement.addEventListener("transitionend",t,{once:!0})})}}]),e}();var u={};u=/*#__PURE__*/function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]];a(this,e),this.initialState=t,this.currentState=JSON.parse(JSON.stringify(this.initialState)),this.status="idle",this.score=0,this.left="ArrowLeft",this.right="ArrowRight",this.up="ArrowUp",this.down="ArrowDown"}return s(e,[{key:"moveLeft",value:function(){"playing"===this.status&&this.slideTiles(this.left,this.currentState)}},{key:"moveRight",value:function(){"playing"===this.status&&this.slideTiles(this.right,this.currentState)}},{key:"moveUp",value:function(){"playing"===this.status&&this.slideTiles(this.up,this.currentState)}},{key:"moveDown",value:function(){"playing"===this.status&&this.slideTiles(this.down,this.currentState)}},{key:"getScore",value:function(){return this.score}},{key:"getState",value:function(){return this.currentState}},{key:"getStatus",value:function(){return this.status}},{key:"start",value:function(){this.status="playing",this.getRandomMatrixValue(),this.getRandomMatrixValue()}},{key:"restart",value:function(){this.score=0,this.status="idle",this.currentState=JSON.parse(JSON.stringify(this.initialState))}},{key:"getRandomValue",value:function(){return Math.random()>.9?4:2}},{key:"getRandomCell",value:function(){for(var e=[],t=0;t<this.currentState.length;t++)for(var r=0;r<this.currentState[t].length;r++)0===this.currentState[t][r]&&e.push({row:t,col:r});if(0===e.length)return null;var n=Math.floor(Math.random()*e.length);return e[n]}},{key:"getRandomMatrixValue",value:function(){var e=this.getRandomCell(),t=e.row,r=e.col,n=this.getRandomValue();t>=0&&r>=0&&0!==n&&(this.currentState[t][r]=n)}},{key:"groupCellsByColumn",value:function(e){var t=function(t){r.push(e.map(function(e){return e[t]}))},r=[];if(e.length>0)for(var n=0;n<e.length;n++)t(n);return r}},{key:"slideTiles",value:function(e,t){var r=this,n=function(n){for(var o=r.currentState.map(function(e){return e[n]}),a=r.slideTilesInGroup(o,e===r.down),l=0;l<t.length;l++)r.currentState[l][n]!==a[l]&&(i=!0,r.currentState[l][n]=a[l])},i=!1;if(e===this.left||e===this.right)for(var o=0;o<t.length;o++){var a=this.currentState[o],l=this.slideTilesInGroup(a,e===this.right);a.join(",")!==l.join(",")&&(i=!0,this.currentState[o]=l)}else if(e===this.up||e===this.down)for(var s=0;s<t.length;s++)n(s);i&&(this.getRandomMatrixValue(),this.checkGameOver())}},{key:"slideTilesInGroup",value:function(e,t){var r=e.filter(function(e){return 0!==e});t&&r.reverse();for(var n=0;n<r.length;n++)r[n]===r[n+1]&&(r[n]*=2,this.score+=r[n],r.splice(n+1,1),2048===r[n]&&(this.status="win"));for(;r.length<e.length;)r.push(0);return t&&r.reverse(),r}},{key:"checkGameOver",value:function(){for(var e=0;e<this.currentState.length;e++)for(var t=0;t<this.currentState[e].length;t++)if(0===this.currentState[e][t]||t<this.currentState[e].length-1&&this.currentState[e][t]===this.currentState[e][t+1]||e<this.currentState[e].length-1&&this.currentState[e][t]===this.currentState[e+1][t])return;this.status="lose"}}]),e}(),document.addEventListener("DOMContentLoaded",function(){var e=function(){for(var e=function(e){for(var r=function(r){var n=t[e][r];if(0!==n){var i=E.find(function(t){return t.row===e&&t.col===r});if(i.linkedTile)return"continue";a(new o(n,L),i)}},n=0;n<t[e].length;n++)r(n)},t=A.getState(),r=0;r<t.length;r++)e(r)},r=function(){var e=!0,t=!1,r=void 0;try{for(var n,i=E[Symbol.iterator]();!(e=(n=i.next()).done);e=!0){var o=n.value;o.linkedTile&&(o.linkedTile.removeFromDom(),o.linkedTile=null,o.linkedTileForMerge=null)}}catch(e){t=!0,r=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw r}}},a=function(e,t){e.setCoords(t.row,t.col),t.linkedTile=e},l=function(e){e.linkedTile=null},s=function(e,t){e.setCoords(t.row,t.col),t.linkedTileForMerge=e},c=function(e){e.linkedTileForMerge=null},h=function(){return E.reduce(function(e,t){return e[t.col]=e[t.col]||[],e[t.col][t.row]=t,e},[])},d=function(){return E.reduce(function(e,t){return e[t.col]=e[t.col]||[],e[t.row][t.col]=t,e},[])},f=function(e){return R.apply(this,arguments)},v=function(e,t){for(var r=1;r<e.length;r++)if(e[r].linkedTile){for(var n,i,o=e[r],u={},c=r-1;c>=0&&(n=e[c],i=o.linkedTile,!n.linkedTile||!n.linkedTileForMerge&&n.linkedTile.value===i.value);)u=e[c],c--;0!==Object.keys(u).length&&(t.push(o.linkedTile.waitForTransitionEnd()),u.linkedTile?s(o.linkedTile,u):a(o.linkedTile,u),l(o))}},m=function(e){e.linkedTile.setValue(e.linkedTile.value+e.linkedTileForMerge.value),e.linkedTileForMerge.removeFromDom(),c(e)},y=function(){window.addEventListener("keydown",g,{once:!0})},g=function(e){return j.apply(this,arguments)},p=document.querySelector(".button"),k=document.querySelector(".message-win"),w=document.querySelector(".message-lose"),S=document.querySelector(".message-start"),b=document.querySelector(".game-score"),L=document.querySelector(".game-field"),T=document.querySelector(".theme-switcher"),E=[];!function(){for(var e=0;e<16;e++)E.push({row:Math.floor(e/4),col:e%4})}();var A=new u,M=h(),q=h().map(function(e){return e.reverse()}),C=d(),x=d().map(function(e){return e.reverse()});function R(){return(R=t(function(e){var t;return i(this,function(r){switch(r.label){case 0:return t=[],e.forEach(function(e){return v(e,t)}),[4,Promise.all(t)];case 1:return r.sent(),E.forEach(function(e){return e.linkedTileForMerge&&m(e)}),[2]}})})).apply(this,arguments)}p.addEventListener("click",function(t){t.target.matches(".start")&&"idle"===A.getStatus()?(A.start(),e(),S.classList.add("hidden")):t.target.matches(".restart")&&(A.restart(),r(),b.textContent=A.getScore(),t.target.classList.remove("restart"),t.target.classList.add("start"),t.target.textContent="Start",k.classList.add("hidden"),w.classList.add("hidden"),S.classList.remove("hidden")),y()}),T.addEventListener("click",function(){var e=document.querySelector(".body"),t=document.querySelector(".theme-switcher__light"),r=document.querySelector(".theme-switcher__dark"),i=L.querySelectorAll(".field-cell");e.matches(".body--light-theme")?(e.classList.remove("body--light-theme"),e.classList.add("body--dark-theme"),t.classList.remove("active"),r.classList.add("active"),L.classList.add("dark-theme"),n(i).forEach(function(e){return e.classList.add("dark-theme")})):(e.classList.add("body--light-theme"),e.classList.remove("body--dark-theme"),t.classList.add("active"),r.classList.remove("active"),L.classList.remove("dark-theme"),n(i).forEach(function(e){return e.classList.remove("dark-theme")}))});var O=document.querySelector(".control__button--up"),F=document.querySelector(".control__button--down"),_=document.querySelector(".control__button--left"),D=document.querySelector(".control__button--right");function j(){return(j=t(function(t){return i(this,function(r){switch(r.label){case 0:if(t.preventDefault(),"playing"!==A.getStatus())return[3,11];switch(t.key){case"ArrowUp":return[3,1];case"ArrowDown":return[3,3];case"ArrowLeft":return[3,5];case"ArrowRight":return[3,7]}return[3,9];case 1:return A.moveUp(),[4,f(M)];case 2:case 4:case 6:case 8:return r.sent(),y(),[3,10];case 3:return A.moveDown(),[4,f(q)];case 5:return A.moveLeft(),[4,f(C)];case 7:return A.moveRight(),[4,f(x)];case 9:return[2,y()];case 10:p.classList.remove("start"),p.classList.add("restart"),p.textContent="Restart",r.label=11;case 11:return e(),b&&(b.textContent=A.getScore()),"lose"===A.getStatus()&&w.classList.remove("hidden"),"win"===A.getStatus()&&k.classList.remove("hidden"),y(),[2]}})})).apply(this,arguments)}O.addEventListener("click",function(){g(new KeyboardEvent("keydown",{key:"ArrowUp"})),y()}),F.addEventListener("click",function(){g(new KeyboardEvent("keydown",{key:"ArrowDown"})),y()}),_.addEventListener("click",function(){g(new KeyboardEvent("keydown",{key:"ArrowLeft"})),y()}),D.addEventListener("click",function(){g(new KeyboardEvent("keydown",{key:"ArrowRight"})),y()})})}();
//# sourceMappingURL=index.687f69bf.js.map
