var e={};e=class{constructor(e,t){this.value=e,this.tileElement=document.createElement("div"),this.tileElement.classList.add("tile"),t.append(this.tileElement),this.setValue(e)}setCoords(e,t){this.row=e,this.col=t,this.tileElement.style.setProperty("--row",e),this.tileElement.style.setProperty("--col",t)}setValue(e){this.value=e,this.tileElement.classList.add(`tile--${this.value}`),this.tileElement.textContent=this.value}removeFromDom(){this.tileElement.remove()}waitForTransitionEnd(){return new Promise(e=>{this.tileElement.addEventListener("transitionend",e,{once:!0})})}};var t={};t=class{constructor(e=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]){this.initialState=e,this.currentState=JSON.parse(JSON.stringify(this.initialState)),this.status="idle",this.score=0,this.left="ArrowLeft",this.right="ArrowRight",this.up="ArrowUp",this.down="ArrowDown"}moveLeft(){"playing"===this.status&&this.slideTiles(this.left,this.currentState)}moveRight(){"playing"===this.status&&this.slideTiles(this.right,this.currentState)}moveUp(){"playing"===this.status&&this.slideTiles(this.up,this.currentState)}moveDown(){"playing"===this.status&&this.slideTiles(this.down,this.currentState)}getScore(){return this.score}getState(){return this.currentState}getStatus(){return this.status}start(){this.status="playing",this.getRandomMatrixValue(),this.getRandomMatrixValue()}restart(){this.score=0,this.status="idle",this.currentState=JSON.parse(JSON.stringify(this.initialState))}getRandomValue(){return Math.random()>.9?4:2}getRandomCell(){let e=[];for(let t=0;t<this.currentState.length;t++)for(let r=0;r<this.currentState[t].length;r++)0===this.currentState[t][r]&&e.push({row:t,col:r});if(0===e.length)return null;let t=Math.floor(Math.random()*e.length);return e[t]}getRandomMatrixValue(){let{row:e,col:t}=this.getRandomCell(),r=this.getRandomValue();e>=0&&t>=0&&0!==r&&(this.currentState[e][t]=r)}groupCellsByColumn(e){let t=[];if(e.length>0)for(let r=0;r<e.length;r++)t.push(e.map(e=>e[r]));return t}slideTiles(e,t){let r=!1;if(e===this.left||e===this.right)for(let i=0;i<t.length;i++){let t=this.currentState[i],s=this.slideTilesInGroup(t,e===this.right);t.join(",")!==s.join(",")&&(r=!0,this.currentState[i]=s)}else if(e===this.up||e===this.down)for(let i=0;i<t.length;i++){let s=this.currentState.map(e=>e[i]),l=this.slideTilesInGroup(s,e===this.down);for(let e=0;e<t.length;e++)this.currentState[e][i]!==l[e]&&(r=!0,this.currentState[e][i]=l[e])}r&&(this.getRandomMatrixValue(),this.checkGameOver())}slideTilesInGroup(e,t){let r=e.filter(e=>0!==e);t&&r.reverse();for(let e=0;e<r.length;e++)r[e]===r[e+1]&&(r[e]*=2,this.score+=r[e],r.splice(e+1,1),2048===r[e]&&(this.status="win"));for(;r.length<e.length;)r.push(0);return t&&r.reverse(),r}checkGameOver(){for(let e=0;e<this.currentState.length;e++)for(let t=0;t<this.currentState[e].length;t++)if(0===this.currentState[e][t]||t<this.currentState[e].length-1&&this.currentState[e][t]===this.currentState[e][t+1]||e<this.currentState[e].length-1&&this.currentState[e][t]===this.currentState[e+1][t])return;this.status="lose"}},document.addEventListener("DOMContentLoaded",()=>{let r=document.querySelector(".button"),i=document.querySelector(".message-win"),s=document.querySelector(".message-lose"),l=document.querySelector(".message-start"),n=document.querySelector(".game-score"),o=document.querySelector(".game-field"),a=document.querySelector(".theme-switcher"),c=[];(function(){for(let e=0;e<16;e++)c.push({row:Math.floor(e/4),col:e%4})})();let d=new t,h=w(),u=w().map(e=>e.reverse()),m=S(),g=S().map(e=>e.reverse());function f(){let t=d.getState();for(let r=0;r<t.length;r++)for(let i=0;i<t[r].length;i++){let s=t[r][i];if(0!==s){let t=c.find(e=>e.row===r&&e.col===i);if(t.linkedTile)continue;v(new e(s,o),t)}}}function v(e,t){e.setCoords(t.row,t.col),t.linkedTile=e}function w(){return c.reduce((e,t)=>(e[t.col]=e[t.col]||[],e[t.col][t.row]=t,e),[])}function S(){return c.reduce((e,t)=>(e[t.col]=e[t.col]||[],e[t.row][t.col]=t,e),[])}async function k(e){let t=[];e.forEach(e=>(function(e,t){for(let n=1;n<e.length;n++){var r,i,s,l;if(!e[n].linkedTile)continue;let o=e[n],a={},c=n-1;for(;c>=0&&(r=e[c],i=o.linkedTile,!r.linkedTile||!r.linkedTileForMerge&&r.linkedTile.value===i.value);)a=e[c],c--;0!==Object.keys(a).length&&((t.push(o.linkedTile.waitForTransitionEnd()),a.linkedTile)?(s=o.linkedTile,l=a,s.setCoords(l.row,l.col),l.linkedTileForMerge=s):v(o.linkedTile,a),o.linkedTile=null)}})(e,t)),await Promise.all(t),c.forEach(e=>e.linkedTileForMerge&&void(e.linkedTile.setValue(e.linkedTile.value+e.linkedTileForMerge.value),e.linkedTileForMerge.removeFromDom(),e.linkedTileForMerge=null))}r.addEventListener("click",function(e){e.target.matches(".start")&&"idle"===d.getStatus()?(d.start(),f(),l.classList.add("hidden")):e.target.matches(".restart")&&(d.restart(),function(){for(let e of c)e.linkedTile&&(e.linkedTile.removeFromDom(),e.linkedTile=null,e.linkedTileForMerge=null)}(),n.textContent=d.getScore(),e.target.classList.remove("restart"),e.target.classList.add("start"),e.target.textContent="Start",i.classList.add("hidden"),s.classList.add("hidden"),l.classList.remove("hidden")),E()}),a.addEventListener("click",function(){let e=document.querySelector(".body"),t=document.querySelector(".theme-switcher__light"),r=document.querySelector(".theme-switcher__dark"),i=o.querySelectorAll(".field-cell");e.matches(".body--light-theme")?(e.classList.remove("body--light-theme"),e.classList.add("body--dark-theme"),t.classList.remove("active"),r.classList.add("active"),o.classList.add("dark-theme"),[...i].forEach(e=>e.classList.add("dark-theme"))):(e.classList.add("body--light-theme"),e.classList.remove("body--dark-theme"),t.classList.add("active"),r.classList.remove("active"),o.classList.remove("dark-theme"),[...i].forEach(e=>e.classList.remove("dark-theme")))});let y=document.querySelector(".control__button--up"),L=document.querySelector(".control__button--down"),p=document.querySelector(".control__button--left"),T=document.querySelector(".control__button--right");function E(){window.addEventListener("keydown",b,{once:!0})}async function b(e){if(e.preventDefault(),"playing"===d.getStatus()){switch(e.key){case"ArrowUp":d.moveUp(),await k(h),E();break;case"ArrowDown":d.moveDown(),await k(u),E();break;case"ArrowLeft":d.moveLeft(),await k(m),E();break;case"ArrowRight":d.moveRight(),await k(g),E();break;default:return E()}r.classList.remove("start"),r.classList.add("restart"),r.textContent="Restart"}f(),n&&(n.textContent=d.getScore()),"lose"===d.getStatus()&&s.classList.remove("hidden"),"win"===d.getStatus()&&i.classList.remove("hidden"),E()}y.addEventListener("click",()=>{b(new KeyboardEvent("keydown",{key:"ArrowUp"})),E()}),L.addEventListener("click",()=>{b(new KeyboardEvent("keydown",{key:"ArrowDown"})),E()}),p.addEventListener("click",()=>{b(new KeyboardEvent("keydown",{key:"ArrowLeft"})),E()}),T.addEventListener("click",()=>{b(new KeyboardEvent("keydown",{key:"ArrowRight"})),E()})});
//# sourceMappingURL=index.574760c1.js.map
